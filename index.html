<html>
  <head>
    <script src="/socket.io/socket.io.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
    <script type="text/javascript">
      $(document).ready(function() {
        var loc = document.location;
        var port = document.location.port;
        var url = loc.protocol + "//" + loc.hostname ;
        if(port.length > 0) {
          url = url + ":" + port
        }

        var socket = io.connect(url);

        socket.on('prose', function(data) {
          $('#dump').append("<p>" + data.prose + "</p");
        });

        socket.on('lockdown', function(data) {
          $('#proseUpdater').unbind();
        });

        var bindWriting = function() {
          $('#proseUpdater').bind('click', function() {
            var proseContainer = $('#prose')[0];
            var proseValue = proseContainer.value;
            proseContainer.value = '';
            socket.emit('message', {prose: proseValue});
            return false;
          });
        };

        socket.on('write', function(data) {
          bindWriting(); 
        });
      });
    </script>
  </head>
  <body>
    <textarea id="prose" style="width: 700px;height: 200px;display: inline-block;margin: 0 auto;"> </textarea>
    <a href="#" id="proseUpdater">Update</a>
    <div id="dump" style="width: 700px;min-height: 200px;display: inline-block;margin: 0 auto;"></div>
  </body>
</html>
